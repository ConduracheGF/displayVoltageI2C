###############################################################################
#
# IAR C/C++ Compiler V7.30.5.1680 for Microchip AVR       18/Jan/2026  12:23:17
# Copyright 1996-2022 IAR Systems AB.
#
#    Source file  =  
#        C:\Users\student\Downloads\displayVoltageI2C-20260118T071946Z-1-001\displayVoltageI2C\cod\functii_afisare.c
#    Command line =  
#        -f C:\Users\student\AppData\Local\Temp\EWF747.tmp
#        (C:\Users\student\Downloads\displayVoltageI2C-20260118T071946Z-1-001\displayVoltageI2C\cod\functii_afisare.c
#        --cpu=m1280 -ms -o
#        C:\Users\student\Downloads\displayVoltageI2C-20260118T071946Z-1-001\displayVoltageI2C\cod\Debug\Obj
#        -lC
#        C:\Users\student\Downloads\displayVoltageI2C-20260118T071946Z-1-001\displayVoltageI2C\cod\Debug\List
#        -lA
#        C:\Users\student\Downloads\displayVoltageI2C-20260118T071946Z-1-001\displayVoltageI2C\cod\Debug\List
#        -y --initializers_in_flash --no_cse --no_inline --no_code_motion
#        --no_cross_call --no_clustering --no_tbaa --debug
#        -DENABLE_BIT_DEFINITIONS -e --eeprom_size 4096 --dlib --dlib_config
#        "C:\Program Files (x86)\IAR Systems\Embedded Workbench
#        8.4\avr\LIB\DLIB\dlAVR-3s-ec_mul-n.h" -On)
#    Locale       =  English_USA.1252
#    List file    =  
#        C:\Users\student\Downloads\displayVoltageI2C-20260118T071946Z-1-001\displayVoltageI2C\cod\Debug\List\functii_afisare.lst
#    Object file  =  
#        C:\Users\student\Downloads\displayVoltageI2C-20260118T071946Z-1-001\displayVoltageI2C\cod\Debug\Obj\functii_afisare.r90
#
###############################################################################

C:\Users\student\Downloads\displayVoltageI2C-20260118T071946Z-1-001\displayVoltageI2C\cod\functii_afisare.c
      1          #include "functii_afisare.h"
      2          #include "functii_i2c.h"
      3          #include "functii_timer.h"
      4          
      5          typedef enum {
      6            DRIVER_NEEDS_INIT,
      7            DRIVER_OK
      8          } driver_state_t;
      9          

   \                                 In  segment NEAR_Z, align 1, keep-with-next
   \   00000000                      REQUIRE `?<Segment init: NEAR_Z>`
     10          static driver_state_t driver_state = DRIVER_NEEDS_INIT;
   \                     driver_state:
   \   00000000                      DS8 1
     11          

   \                                 In  segment CODE, align 2, keep-with-next
     12          static send_status_t send_i2c(uint8_t addr_dummy, uint8_t reg, uint8_t val) {
   \                     send_i2c:
   \   00000000   ........           CALL    ?PROLOGUE3_L09
   \   00000004   9722               SBIW    R29:R28, 2
   \   00000006   2F80               MOV     R24, R16
   \   00000008   2F91               MOV     R25, R17
   \   0000000A   2FA2               MOV     R26, R18
     13              uint8_t data[2];
     14              data[0] = reg;
   \   0000000C   8398               ST      Y, R25
     15              data[1] = val;
   \   0000000E   83A9               STD     Y+1, R26
     16          
     17              while(i2c_is_busy());
   \                     ??send_i2c_0:
   \   00000010   ........           CALL    i2c_is_busy
   \   00000014   2300               TST     R16
   \   00000016   F7E1               BRNE    ??send_i2c_0
     18              if(i2c_write_transaction(addr_dummy, data, 2) != I2C_STATUS_SUCCESS) return SEND_NOT_SUCCESSFUL;
   \   00000018   E012               LDI     R17, 2
   \   0000001A   019E               MOVW    R19:R18, R29:R28
   \   0000001C   2F08               MOV     R16, R24
   \   0000001E   ........           CALL    i2c_write_transaction
   \   00000022   2300               TST     R16
   \   00000024   F011               BREQ    ??send_i2c_1
   \   00000026   E001               LDI     R16, 1
   \   00000028   C00B               RJMP    ??send_i2c_2
     19              while(i2c_is_busy());
   \                     ??send_i2c_1:
   \   0000002A   ........           CALL    i2c_is_busy
   \   0000002E   2300               TST     R16
   \   00000030   F7E1               BRNE    ??send_i2c_1
     20              
     21              if(i2c_get_last_status() != I2C_STATUS_SUCCESS) return SEND_NOT_SUCCESSFUL;
   \   00000032   ........           CALL    i2c_get_last_status
   \   00000036   2300               TST     R16
   \   00000038   F011               BREQ    ??send_i2c_3
   \   0000003A   E001               LDI     R16, 1
   \   0000003C   C001               RJMP    ??send_i2c_2
     22              return SEND_SUCCESSFUL;
   \                     ??send_i2c_3:
   \   0000003E   E000               LDI     R16, 0
   \                     ??send_i2c_2:
   \   00000040   9622               ADIW    R29:R28, 2
   \   00000042   E0E3               LDI     R30, 3
   \   00000044   ........           JMP     ?EPILOGUE_B3_L09
     23          }
     24          

   \                                 In  segment CODE, align 2, keep-with-next
     25          send_status_t setup_7_segm(){
   \                     setup_7_segm:
     26            if(send_i2c(0x00, 0x09, 0xFF) != SEND_SUCCESSFUL) return SEND_NOT_SUCCESSFUL;
   \   00000000   EF2F               LDI     R18, 255
   \   00000002   E019               LDI     R17, 9
   \   00000004   E000               LDI     R16, 0
   \   00000006   ....               RCALL   send_i2c
   \   00000008   2300               TST     R16
   \   0000000A   F011               BREQ    ??setup_7_segm_0
   \   0000000C   E001               LDI     R16, 1
   \   0000000E   9508               RET
     27            if(send_i2c(0x00, 0x0A, 0x0F) != SEND_SUCCESSFUL) return SEND_NOT_SUCCESSFUL;
   \                     ??setup_7_segm_0:
   \   00000010   E02F               LDI     R18, 15
   \   00000012   E01A               LDI     R17, 10
   \   00000014   E000               LDI     R16, 0
   \   00000016   ....               RCALL   send_i2c
   \   00000018   2300               TST     R16
   \   0000001A   F011               BREQ    ??setup_7_segm_1
   \   0000001C   E001               LDI     R16, 1
   \   0000001E   9508               RET
     28            if(send_i2c(0x00, 0x0B, 0x03) != SEND_SUCCESSFUL) return SEND_NOT_SUCCESSFUL;
   \                     ??setup_7_segm_1:
   \   00000020   E023               LDI     R18, 3
   \   00000022   E01B               LDI     R17, 11
   \   00000024   E000               LDI     R16, 0
   \   00000026   ....               RCALL   send_i2c
   \   00000028   2300               TST     R16
   \   0000002A   F011               BREQ    ??setup_7_segm_2
   \   0000002C   E001               LDI     R16, 1
   \   0000002E   9508               RET
     29            if(send_i2c(0x00, 0x0C, 0x01) != SEND_SUCCESSFUL) return SEND_NOT_SUCCESSFUL;
   \                     ??setup_7_segm_2:
   \   00000030   E021               LDI     R18, 1
   \   00000032   E01C               LDI     R17, 12
   \   00000034   E000               LDI     R16, 0
   \   00000036   ....               RCALL   send_i2c
   \   00000038   2300               TST     R16
   \   0000003A   F011               BREQ    ??setup_7_segm_3
   \   0000003C   E001               LDI     R16, 1
   \   0000003E   9508               RET
     30            return SEND_SUCCESSFUL;
   \                     ??setup_7_segm_3:
   \   00000040   E000               LDI     R16, 0
   \   00000042   9508               RET
     31          }
     32          

   \                                 In  segment CODE, align 2, keep-with-next
     33          static send_status_t afisare(int cifra[]) {
   \                     afisare:
   \   00000000   ........           CALL    ?PROLOGUE4_L09
   \   00000004   01D8               MOVW    R27:R26, R17:R16
     34              for (int i = 0; i < 4; i++) {
   \   00000006   E080               LDI     R24, 0
   \   00000008   E090               LDI     R25, 0
   \                     ??afisare_0:
   \   0000000A   3084               CPI     R24, 4
   \   0000000C   E000               LDI     R16, 0
   \   0000000E   0790               CPC     R25, R16
   \   00000010   F4DC               BRGE    ??afisare_1
     35                if(send_i2c(0x00, i + 1, cifra[3-i]) != SEND_SUCCESSFUL) return SEND_NOT_SUCCESSFUL;
   \   00000012   018C               MOVW    R17:R16, R25:R24
   \   00000014   9511               NEG     R17
   \   00000016   9501               NEG     R16
   \   00000018   4010               SBCI    R17, 0
   \   0000001A   0F00               LSL     R16
   \   0000001C   1F11               ROL     R17
   \   0000001E   01FD               MOVW    R31:R30, R27:R26
   \   00000020   0FE0               ADD     R30, R16
   \   00000022   1FF1               ADC     R31, R17
   \   00000024   8126               LDD     R18, Z+6
   \   00000026   8137               LDD     R19, Z+7
   \   00000028   2F18               MOV     R17, R24
   \   0000002A   9513               INC     R17
   \   0000002C   E000               LDI     R16, 0
   \   0000002E   ....               RCALL   send_i2c
   \   00000030   2300               TST     R16
   \   00000032   F011               BREQ    ??afisare_2
   \   00000034   E001               LDI     R16, 1
   \   00000036   C009               RJMP    ??afisare_3
     36                delay_milisecunde(50);
   \                     ??afisare_2:
   \   00000038   E302               LDI     R16, 50
   \   0000003A   E010               LDI     R17, 0
   \   0000003C   E020               LDI     R18, 0
   \   0000003E   E030               LDI     R19, 0
   \   00000040   ........           CALL    delay_milisecunde
     37              }
   \   00000044   9601               ADIW    R25:R24, 1
   \   00000046   CFE1               RJMP    ??afisare_0
     38              return SEND_SUCCESSFUL;
   \                     ??afisare_1:
   \   00000048   E000               LDI     R16, 0
   \                     ??afisare_3:
   \   0000004A   E0E4               LDI     R30, 4
   \   0000004C   ........           JMP     ?EPILOGUE_B4_L09
     39          }
     40          

   \                                 In  segment CODE, align 2, keep-with-next
     41          send_status_t afisare_tensiune(uint16_t mV) {
   \                     afisare_tensiune:
   \   00000000   ........           CALL    ?PROLOGUE4_L09
   \   00000004   9728               SBIW    R29:R28, 8
   \   00000006   01C8               MOVW    R25:R24, R17:R16
     42            int cifra[4] = {0};
   \   00000008   018E               MOVW    R17:R16, R29:R28
   \   0000000A   01F8               MOVW    R31:R30, R17:R16
   \   0000000C   E020               LDI     R18, 0
   \   0000000E   E0A8               LDI     R26, 8
   \                     ??afisare_tensiune_0:
   \   00000010   9321               ST      Z+, R18
   \   00000012   95AA               DEC     R26
   \   00000014   F7E9               BRNE    ??afisare_tensiune_0
     43            if (mV > 5000) mV = 5000;
   \   00000016   3889               CPI     R24, 137
   \   00000018   E103               LDI     R16, 19
   \   0000001A   0790               CPC     R25, R16
   \   0000001C   F010               BRCS    ??afisare_tensiune_1
   \   0000001E   E888               LDI     R24, 136
   \   00000020   E193               LDI     R25, 19
     44            cifra[0] = ((mV/1000)%10) | 0x80;
   \                     ??afisare_tensiune_1:
   \   00000022   EE48               LDI     R20, 232
   \   00000024   E053               LDI     R21, 3
   \   00000026   018C               MOVW    R17:R16, R25:R24
   \   00000028   ........           CALL    ?US_DIVMOD_L02
   \   0000002C   E04A               LDI     R20, 10
   \   0000002E   E050               LDI     R21, 0
   \   00000030   ........           CALL    ?US_DIVMOD_L02
   \   00000034   6840               ORI     R20, 0x80
   \   00000036   6050               ORI     R21, 0x00
   \   00000038   8348               ST      Y, R20
   \   0000003A   8359               STD     Y+1, R21
     45            cifra[1] = (mV/100)%10;
   \   0000003C   E644               LDI     R20, 100
   \   0000003E   E050               LDI     R21, 0
   \   00000040   018C               MOVW    R17:R16, R25:R24
   \   00000042   ........           CALL    ?US_DIVMOD_L02
   \   00000046   E04A               LDI     R20, 10
   \   00000048   E050               LDI     R21, 0
   \   0000004A   ........           CALL    ?US_DIVMOD_L02
   \   0000004E   834A               STD     Y+2, R20
   \   00000050   835B               STD     Y+3, R21
     46            cifra[2] = (mV/10)%10;
   \   00000052   E04A               LDI     R20, 10
   \   00000054   E050               LDI     R21, 0
   \   00000056   018C               MOVW    R17:R16, R25:R24
   \   00000058   ........           CALL    ?US_DIVMOD_L02
   \   0000005C   E04A               LDI     R20, 10
   \   0000005E   E050               LDI     R21, 0
   \   00000060   ........           CALL    ?US_DIVMOD_L02
   \   00000064   834C               STD     Y+4, R20
   \   00000066   835D               STD     Y+5, R21
     47            cifra[3] = mV%10;
   \   00000068   E04A               LDI     R20, 10
   \   0000006A   E050               LDI     R21, 0
   \   0000006C   018C               MOVW    R17:R16, R25:R24
   \   0000006E   ........           CALL    ?US_DIVMOD_L02
   \   00000072   834E               STD     Y+6, R20
   \   00000074   835F               STD     Y+7, R21
     48            return afisare(cifra);
   \   00000076   018E               MOVW    R17:R16, R29:R28
   \   00000078   ....               RCALL   afisare
   \   0000007A   9628               ADIW    R29:R28, 8
   \   0000007C   E0E4               LDI     R30, 4
   \   0000007E   ........           JMP     ?EPILOGUE_B4_L09
     49          }
     50          

   \                                 In  segment CODE, align 2, keep-with-next
     51          void Display_Task_Run(uint16_t valoare_tensiune) {
   \                     Display_Task_Run:
   \   00000000   939A               ST      -Y, R25
   \   00000002   938A               ST      -Y, R24
   \   00000004   01C8               MOVW    R25:R24, R17:R16
     52              static uint16_t safety_counter = 0;
     53              
     54              switch (driver_state) {
   \   00000006   9100....           LDS     R16, driver_state
   \   0000000A   5000               SUBI    R16, 0
   \   0000000C   F019               BREQ    ??Display_Task_Run_0
   \   0000000E   950A               DEC     R16
   \   00000010   F071               BREQ    ??Display_Task_Run_1
   \   00000012   C027               RJMP    ??Display_Task_Run_2
     55                  case DRIVER_NEEDS_INIT:
     56                      if (setup_7_segm() == SEND_SUCCESSFUL) {
   \                     ??Display_Task_Run_0:
   \   00000014   ....               RCALL   setup_7_segm
   \   00000016   2300               TST     R16
   \   00000018   F521               BRNE    ??Display_Task_Run_2
     57                          driver_state = DRIVER_OK;
   \   0000001A   E001               LDI     R16, 1
   \   0000001C   9300....           STS     driver_state, R16
     58                          safety_counter = 0;
   \   00000020   ....               LDI     R30, LOW(??safety_counter)
   \   00000022   ....               LDI     R31, (??safety_counter) >> 8
   \   00000024   E000               LDI     R16, 0
   \   00000026   8300               ST      Z, R16
   \   00000028   E000               LDI     R16, 0
   \   0000002A   8301               STD     Z+1, R16
     59                      }
     60                      break;
   \   0000002C   C01A               RJMP    ??Display_Task_Run_2
     61                      
     62                  case DRIVER_OK:
     63                      if (afisare_tensiune(valoare_tensiune) != SEND_SUCCESSFUL) {
   \                     ??Display_Task_Run_1:
   \   0000002E   018C               MOVW    R17:R16, R25:R24
   \   00000030   ....               RCALL   afisare_tensiune
   \   00000032   2300               TST     R16
   \   00000034   F019               BREQ    ??Display_Task_Run_3
     64                          driver_state = DRIVER_NEEDS_INIT;
   \   00000036   E000               LDI     R16, 0
   \   00000038   9300....           STS     driver_state, R16
     65                      }
     66                      if (++safety_counter >= 100) driver_state = DRIVER_NEEDS_INIT;
   \                     ??Display_Task_Run_3:
   \   0000003C   ....               LDI     R30, LOW(??safety_counter)
   \   0000003E   ....               LDI     R31, (??safety_counter) >> 8
   \   00000040   8100               LD      R16, Z
   \   00000042   8111               LDD     R17, Z+1
   \   00000044   5F0F               SUBI    R16, 255
   \   00000046   4F1F               SBCI    R17, 255
   \   00000048   8300               ST      Z, R16
   \   0000004A   8311               STD     Z+1, R17
   \   0000004C   ....               LDI     R30, LOW(??safety_counter)
   \   0000004E   ....               LDI     R31, (??safety_counter) >> 8
   \   00000050   8100               LD      R16, Z
   \   00000052   8111               LDD     R17, Z+1
   \   00000054   3604               CPI     R16, 100
   \   00000056   E020               LDI     R18, 0
   \   00000058   0712               CPC     R17, R18
   \   0000005A   F018               BRCS    ??Display_Task_Run_2
   \   0000005C   E000               LDI     R16, 0
   \   0000005E   9300....           STS     driver_state, R16
     67                      break;
     68              }
     69          }
   \                     ??Display_Task_Run_2:
   \   00000062   9189               LD      R24, Y+
   \   00000064   9199               LD      R25, Y+
   \   00000066   9508               RET

   \                                 In  segment NEAR_Z, align 1, keep-with-next
   \   00000000                      REQUIRE `?<Segment init: NEAR_Z>`
   \                     ??safety_counter:
   \   00000000                      DS8 2
     70          

   \                                 In  segment CODE, align 2, keep-with-next
     71          bool Display_Is_Error(void) {
   \                     Display_Is_Error:
     72              return (driver_state == DRIVER_NEEDS_INIT);
   \   00000000   9100....           LDS     R16, driver_state
   \   00000004   2300               TST     R16
   \   00000006   F411               BRNE    ??Display_Is_Error_0
   \   00000008   E001               LDI     R16, 1
   \   0000000A   9508               RET
   \                     ??Display_Is_Error_0:
   \   0000000C   E000               LDI     R16, 0
   \   0000000E   9508               RET
     73          }

   \                                 In  segment FAR_F, align 1, keep-with-next
   \   00000000   000000000000       DC16 0, 0, 0, 0
   \              0000        

   Maximum stack usage in bytes:

   CSTACK RSTACK Function
   ------ ------ --------
      0      2   Display_Is_Error
      2      2   Display_Task_Run
        2      2   -> afisare_tensiune
        2      2   -> setup_7_segm
      4      2   afisare
        4      2   -> delay_milisecunde
        4      2   -> send_i2c
     12      2   afisare_tensiune
       12      2   -> afisare
       12      2 ?US_DIVMOD_L02
      5      2   send_i2c
        5      2   -> i2c_get_last_status
        5      2   -> i2c_is_busy
        5      2   -> i2c_write_transaction
      0      2   setup_7_segm
        0      2   -> send_i2c


   Segment part sizes:

   Bytes  Function/Label
   -----  --------------
       8  ?<Constant {0, 0, 0, 0}>
      16  Display_Is_Error
     104  Display_Task_Run
      80  afisare
     130  afisare_tensiune
       1  driver_state
       2  safety_counter
      72  send_i2c
      68  setup_7_segm
       7  -- Other

 
 470 bytes in segment CODE
   8 bytes in segment FAR_F
   7 bytes in segment INITTAB
   3 bytes in segment NEAR_Z
 
 478 bytes of CODE memory (+ 7 bytes shared)
   3 bytes of DATA memory

Errors: none
Warnings: none
